generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Esto es tentativo y se iran anexando mas opciones de dataType segun requieran los otros modulos
enum DataType {
  Kitchen
  Dp
}

enum PermissionType {
  View
  Resource
}

enum Resource {
  // Tablas de seguridad
  Restaurant_seguridad
  User_seguridad
  Role_seguridad
  Permission_seguridad
  // Tablas de cocina 
  KitchenCategory_cocina
  KitchenProduct_cocina
  Recipe_cocina
  InventoryItem_cocina
  InventoryLog_cocina
  KitchenAsset_cocina
  AssetLog_cocina
  KitchenStaff_cocina
  StaffShift_cocina
  KdsProductionQueue_cocina
  // Tablas de kpi (Ojo estas pueden cambiar pq todavia andan cambiando los nombres de las tablas)
  KpiMetas_kpi
  KpiReglaSemaforo_kpi
  KpiSnapshotDiario_kpi
  KpiAlertaHistorial_kpi
  KpiAuditoriaExport_kpi
  // Tablas de ATC
  Table_atc
  ClienteTemporal_atc
  Comanda_atc
  OrderItem_atc
  ServiceRequest_atc
  // Tablas de Delivery y Pickup
  Zones_dp
  Thresholds_dp
  Managers_dp
  Notes_dp
  NotesItems_dp
  Logs_dp

  // Vistas

  // Vistas de cocina
  KdsProductionQueue_view
  ConsumibleInventory_view
  RecipeProductCatalog_view
  FixedAssetManagement_view
  AuditTransactionLog_view
  WaitersOffice_view
  StaffShiftSheduler_view
  KitchenStaffManagement_view

  // Vistas de Delivery y Pickup
  DeliveryPickup_view

  // Vistas de kpi
  KpiDashboard_view

  // Vistas de seguridad
  UserManagement_view
  RestaurantCoordinates_view

  // Vistas de ATC
  TableManagement_view

  // Permisos definitivos faltantes
  Security_view
  Kitchen_view
  Atc_view

  AtcJefeSala_view
  // Nuevos permisos post presentacion

  // Atc
  AtcSupervisorSala_view
  AtcMaitre_view

  // Delivery y Pickup
  DpSupervisor_view
  DpDespachador_view

  // cocina
  CocinaSupervisor_view // esta no se usara 
  CocinaChef_view
  CocinaCocinero_view
  CocinaCamarero_view

  // seguridad
  SeguridadPersonal_view

  // kpi
  KpiSupervisor_view // esta no se usara
  KpiGerente_view
}

enum Method {
  // Para type Resource
  Create
  Read
  Update
  Delete
  All
  // Para type View
  View
}

// --- MODELOS ---

model Restaurant {
  id        Int     @id @default(autoincrement())

  latitude  Decimal @db.Decimal(10, 8)
  longitud  Decimal @db.Decimal(10, 8)
  radius    Decimal @db.Decimal(10, 2)
  required Boolean @default(true)
}

model User {
  id               Int       @id @default(autoincrement())
  name           String
  lastName         String
  email           String    @unique
  address        String?
  phone         String?
  dataType        DataType?
  password       String    // evita usar "ñ" en nombres de campos
  birthDate       DateTime
  dni              String   @unique
  isAdmin        Boolean   @default(false)
  isActive       Boolean   @default(true)

  // M:N con Rol (tabla intermedia implícita)
  roles            Role[]

  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

model Role {
  id          Int        @id @default(autoincrement())
  name        String      
  description String?

  // inversa M:N con Usuario
  users       User[]

  // 1:N con Permiso
  permissions Permission[]

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Permission {
  id        Int          @id @default(autoincrement())
  name      String
  type      PermissionType
  resource  Resource
  method    Method

  // N:1 con Role
  roleId    Int
  role      Role          @relation(fields: [roleId], references: [id], onDelete: Cascade)

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt


}

model SecurityProductExample {
  id        Int      @id @default(autoincrement())
  name      String
  quantity  Int
  price     Decimal   @db.Decimal(10, 2)
  stock    Int
  category  String
}